{"version":3,"sources":["../../src/tasks/browserSync.js"],"names":["module","exports","cfg","gulp","task","console","log","basename","process","cwd","dir_docs","init","startPath","server","baseDir","routes","dir_pages","browser","scrollElements","ghostMode","notify","snippetOptions","ignorePaths","rule","match","fn","snippet","start","dir_views","event","path","tmpCss","tmpJs","dir_sass","dir_js","dir_img"],"mappings":"AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEAA,OAAOC,OAAP,GAAiB,UAASC,GAAT,EAAcC,IAAd,EAAoB;AACnCA,OAAKC,IAAL,CAAU,MAAV,EAAkB,YAAM;AACtBC,YAAQC,GAAR,CAAe,eAAKC,QAAL,CAAcC,QAAQC,GAAR,EAAd,CAAf,SAA+CP,IAAIQ,QAAnD;AACA,0BAAYC,IAAZ,CAAiB;AACfC,iBAAW,iBADI;AAEfC,cAAQ;AACNC,iBAAS,IADH;AAENC;AACE,wBAAYb,IAAIQ,QADlB;AAEE,yBAAaR,IAAIc;AAFnB,WAGKd,IAAIa,MAHT,CAFM;AAONE,iBAAS,SAPH;AAQNC,wBAAgBhB,IAAIgB,cAAJ,IAAsB;AARhC,OAFO;AAYfC,iBAAW,KAZI;AAafC,cAAQ,KAbO;;AAefC,sBAAgB;AACdC,qBAAa,aADC;AAEdC,cAAM;AACJC,iBAAO,WADH;AAEJC,cAAI,YAASC,OAAT,EAAkBF,KAAlB,EAAyB;AAC3B,mBAAOE,UAAUF,KAAjB;AACD;AAJG;AAFQ;AAfD,KAAjB;AAyBD,GA3BD;;AA6BArB,OAAKC,IAAL,CAAU,OAAV,EAAmB,CAAC,OAAD,CAAnB,EAA8B,YAAM;AAElC,QAAIF,IAAIc,SAAR,EAAmB;AACjBb,WAAKwB,KAAL,CAAW,MAAX;AACD;;AAGD,QAAIzB,IAAI0B,SAAR,EAAmB;AACjBzB,WAAKwB,KAAL,CAAW,aAAX;AACD;AACD,QAAIzB,IAAIc,SAAR,EAAmB;AACjB,+BAAM,CAAId,IAAIc,SAAR,gBAAN,EAAsC,UAACa,KAAD,EAAW;AAC/C,YAAIA,MAAMA,KAAN,KAAgB,QAApB,EAA8B;AAC5B1B,eAAKwB,KAAL,CAAW,OAAX;AACD,SAFD,MAEO;AACL,mCAAOE,MAAMC,IAAb;AACD;AACF,OAND;AAOA,+BAAM,CAAI5B,IAAI6B,MAAR,eAAN,EAAkC,UAACF,KAAD,EAAW;AAC3C,iCAAOA,MAAMC,IAAb;AACD,OAFD;AAGA,+BAAM,CAAI5B,IAAI8B,KAAR,cAAN,EAAgC,UAACH,KAAD,EAAW;AACzC,iCAAOA,MAAMC,IAAb;AACD,OAFD;AAGD;;AAGD,QAAI5B,IAAI+B,QAAR,EAAkB;AAChB,+BAAM,CAAI/B,IAAI+B,QAAR,kBAAN,EAAuC;AAAA,eAAS9B,KAAKwB,KAAL,CAAW,QAAX,CAAT;AAAA,OAAvC;AACA,+BAAM,CAAIzB,IAAI+B,QAAR,iBAAN,EAAsC;AAAA,eAAS9B,KAAKwB,KAAL,CAAW,cAAX,CAAT;AAAA,OAAtC;AACD;;AAGD,QAAIzB,IAAIgC,MAAR,EAAgB;AACd,+BAAM,CAAIhC,IAAIgC,MAAR,cAAN,EAAiC;AAAA,eAAS/B,KAAKwB,KAAL,CAAW,SAAX,CAAT;AAAA,OAAjC;AACD;;AAGD,QAAIzB,IAAIiC,OAAR,EAAiB;AACfhC,WAAKwB,KAAL,CAAW,eAAX;AACD;AAEF,GA1CD;AA4CD,CA1ED","file":"browserSync.js","sourcesContent":["'use strict';\nimport watch from 'gulp-watch';\nimport browserSync, {reload} from 'browser-sync';\nimport path from 'path';\n\nmodule.exports = function(cfg, gulp) {\n  gulp.task('demo', () => {\n    console.log(`${path.basename(process.cwd())}/${cfg.dir_docs}`);\n    browserSync.init({\n      startPath: 'docs/index.html',\n      server: {\n        baseDir: './',\n        routes: {\n          '/docs': `${cfg.dir_docs}`,\n          '/pages': `${cfg.dir_pages}`,\n          ...cfg.routes\n        },\n        browser: 'default',\n        scrollElements: cfg.scrollElements || []\n      },\n      ghostMode: false,\n      notify: false,\n      // 代码片段插入配置... ignorePaths: ignore all HTML files within the templates folder\n      snippetOptions: {\n        ignorePaths: 'docs/*.html',\n        rule: {\n          match: /<\\/body>/i,\n          fn: function(snippet, match) {\n            return snippet + match;\n          }\n        }\n      }\n    });\n  });\n\n  gulp.task('serve', ['clean'], () => {\n    // html\n    if (cfg.dir_pages) {\n      gulp.start('demo');\n    }\n\n    // watch tasks\n    if (cfg.dir_views) {\n      gulp.start('watch-views'); // 监听views，通过nunjucks生成html\n    }\n    if (cfg.dir_pages) {\n      watch([`${cfg.dir_pages}/**/*.html`], (event) => {\n        if (event.event !== 'change') {\n          gulp.start('guide');\n        } else {\n          reload(event.path);\n        }\n      });\n      watch([`${cfg.tmpCss}/**/*.css`], (event) => {\n        reload(event.path);\n      });\n      watch([`${cfg.tmpJs}/**/*.js`], (event) => {\n        reload(event.path);\n      });\n    }\n\n    // css 预处理 watch tasks\n    if (cfg.dir_sass) {\n      watch([`${cfg.dir_sass}/**/*.{scss}`], event => gulp.start('styles'));\n      watch([`${cfg.dir_sass}/**/_*.scss`], event => gulp.start('styles:force'));\n    }\n\n    // js babel相关 watch tasks\n    if (cfg.dir_js) {\n      watch([`${cfg.dir_js}/**/*.js`], event => gulp.start('scripts'));\n    }\n\n    // watch sprites\n    if (cfg.dir_img) {\n      gulp.start('watch-sprites');\n    }\n\n  });\n\n};\n"]}