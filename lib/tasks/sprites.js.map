{"version":3,"sources":["../../src/tasks/sprites.js"],"names":["path","require","spritesmith","watch","mergeStream","module","exports","cfg","gulp","task","dir_img","resolve","__dirname","event","start","del","sync","dir_sass","dir_less","force","list","onlyDirectory","forEach","v","i","temp","spriteData","dirName","basename","outputName","spriteOptions","obj","match","replace","retinaSrcFilter","retinaImgName","cssTemplate","imgName","cssName","padding","cssSpritesheetName","console","log","src","pipe","imgStream","img","dest","distImg","cssStream","css"],"mappings":"AAAA;;AAKA;;;;;;AACA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;;AAEA,IAAIC,cAAcD,QAAQ,kBAAR,CAAlB;AACA,IAAIE,QAAQF,QAAQ,YAAR,CAAZ;AACA,IAAIG,cAAcH,QAAQ,cAAR,CAAlB;;AAEAI,OAAOC,OAAP,GAAiB,UAASC,GAAT,EAAcC,IAAd,EAAoB;;AAEnCA,OAAKC,IAAL,CAAU,eAAV,EAA2B,YAAM;AAC/BN,UAAM,CACJI,IAAIG,OAAJ,GAAc,iBADV,EAEJV,KAAKW,OAAL,CAAaC,SAAb,EAAuB,kDAAvB,CAFI,EAGJZ,KAAKW,OAAL,CAAaC,SAAb,EAAuB,kDAAvB,CAHI,CAAN,EAIG,UACDC,KADC,EACM;AACPL,WAAKM,KAAL,CAAW,SAAX;AACD,KAPD;AAQD,GATD;;AAWAN,OAAKC,IAAL,CAAU,eAAV,EAA2B,YAAW;AACpCM,QAAIC,IAAJ,CAAS,CACJT,IAAIG,OADA,gBAGJH,IAAIU,QAAJ,IAAcV,IAAIW,QAHd,eAAT,EAIG;AACDC,aAAO,IADN,EAJH;AAOD,GARD;;AAWAX,OAAKC,IAAL,CAAU,SAAV,EAAqB,YAAW;AAC9B,QAAIW,OAAO,uBAAWb,IAAIG,OAAf,aAAgC;AACzCW,qBAAe;AAD0B,KAAhC,CAAX;AAGAD,SAAKE,OAAL,CAAa,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC1B,UAAIC,IAAJ;AACA,UAAIC,UAAJ;AACA,UAAIC,UAAU3B,KAAK4B,QAAL,CAAcL,CAAd,CAAd;AACA,UAAIM,aAAaF,OAAjB;;AAEA,UAAIG,gBAAiB,YAAW;AAC9B,YAAIC,MAAM,EAAV;AACA,YAAId,WAAWV,IAAIU,QAAnB;AAAA,YACEC,WAAWX,IAAIW,QADjB;AAEA,YAAIW,WAAWG,KAAX,CAAiB,SAAjB,CAAJ,EAAiC;AAC/BH,uBAAaA,WAAWI,OAAX,CAAmB,SAAnB,EAA8B,EAA9B,CAAb;AACAF,cAAIG,eAAJ,GAAsB,CAACX,IACrB,WADoB,CAAtB;AAGAQ,cAAII,aAAJ,GAAuBN,UAAvB;AACD;;AAEDJ,eAAOR,WAAW,MAAX,GAAoB,MAA3B;;AAEAc,YAAIK,WAAJ,GAAkBpC,KAAKW,OAAL,CAAaC,SAAb,+BAAkDa,IAAlD,0BAAlB;AACAA,eAAOR,WAAW,OAAX,GAAqB,OAA5B;AACAc,YAAIM,OAAJ,GAAiBR,UAAjB;AACAE,YAAIO,OAAJ,SAAkBT,UAAlB,GAA+BJ,IAA/B;AACAM,YAAIQ,OAAJ,GAAc,CAAd;;AAEAR,YAAIS,kBAAJ,GAAyBX,UAAzB;;AAEA,eAAOE,GAAP;AACD,OAvBoB,EAArB;AAwBAU,cAAQC,GAAR,CAAYZ,aAAZ;AACAJ,mBAAalB,KAAKmC,GAAL,CAASpB,IAAI,QAAb,EACVqB,IADU,CACL1C,YAAY4B,aAAZ,CADK,CAAb;AAEA,UAAIe,YAAYnB,WAAWoB,GAAX,CAGbF,IAHa,CAGRpC,KAAKuC,IAAL,CAAaxC,IAAIyC,OAAjB,cAHQ,CAAhB;AAIA,UAAIC,YAAYvB,WAAWwB,GAAX,CAEbN,IAFa,CAERpC,KAAKuC,IAAL,EAAaxC,IAAIU,QAAJ,IAAgBV,IAAIW,QAAjC,eAFQ,CAAhB;AAGA,aAAOd,YAAYyC,SAAZ,EAAuBI,SAAvB,CAAP;AACD,KAzCD;AA0CD,GA9CD;AAgDD,CAxED","file":"sprites.js","sourcesContent":["'use strict';\n/**\n * @author linjilin\n * @lastmodifiedDate 2016/07/18\n */\nimport explore from '../explore';\nvar path = require('path');\n\nvar spritesmith = require('gulp.spritesmith');\nvar watch = require('gulp-watch');\nvar mergeStream = require('merge-stream');\n\nmodule.exports = function(cfg, gulp) {\n\n  gulp.task('watch-sprites', () => {\n    watch([\n      cfg.dir_img + '/slice/**/*.png',\n      path.resolve(__dirname,'../../templates/sprites-less-template.handlebars'),\n      path.resolve(__dirname,'../../templates/sprites-sass-template.handlebars')\n    ], function(\n      event) {\n      gulp.start('sprites');\n    });\n  });\n\n  gulp.task('clean-sprites', function() {\n    del.sync([\n      `${cfg.dir_img}/sprites`,\n      // `${cfg.dist_img}/sprites`,\n      `${cfg.dir_sass||cfg.dir_less}/sprites`\n    ], {\n      force: true //当输出的文件夹不在gulp服务的文件夹内时加上 force\n    });\n  });\n\n  // sprites\n  gulp.task('sprites', function() {\n    var list = explore(`${cfg.dir_img}/slice`, {\n      onlyDirectory: true\n    });\n    list.forEach(function(v, i) {\n      var temp;\n      var spriteData;\n      var dirName = path.basename(v);\n      var outputName = dirName;\n      // 仅当有rem-前缀才进行rem的雪碧图拼合\n      var spriteOptions = (function() {\n        var obj = {};\n        var dir_sass = cfg.dir_sass,\n          dir_less = cfg.dir_less;\n        if (outputName.match(/-retina/)) {\n          outputName = outputName.replace('-retina', '');\n          obj.retinaSrcFilter = [v +\n            '/*@2x.png'\n          ];\n          obj.retinaImgName = `${outputName}@2x.png`;\n        }\n        // if (outputName.match(/-rem/)) {obj.cssHandlebarsHelpers = function(){};}\n        temp = dir_sass ? 'sass' : 'less';\n\n        obj.cssTemplate = path.resolve(__dirname,`../../templates/sprites-${temp}-template.handlebars`);\n        temp = dir_sass ? '.scss' : '.less';\n        obj.imgName = `${outputName}.png`;\n        obj.cssName = `_${outputName}${temp}`;\n        obj.padding = 1;\n        // obj.cssSpritesheetName = dirName;\n        obj.cssSpritesheetName = outputName;\n        // console.log(obj.cssTemsplate);\n        return obj;\n      }());\n      console.log(spriteOptions);\n      spriteData = gulp.src(v + '/*.png')\n        .pipe(spritesmith(spriteOptions));\n      var imgStream = spriteData.img\n        // .pipe(buffer())\n        // .pipe(imagemin())\n        .pipe(gulp.dest(`${cfg.distImg}/sprites`));\n      var cssStream = spriteData.css\n        // .pipe(buffer())\n        .pipe(gulp.dest(`${cfg.dir_sass || cfg.dir_less}/sprites`));\n      return mergeStream(imgStream, cssStream);\n    });\n  }); // sprites END\n\n};\n"]}